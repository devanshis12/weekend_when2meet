<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Summer 2026 Weekends</title>

  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #fffafc;
      text-align: center;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #6d6875;
    }

    .subtitle {
      color: #b5838d;
      margin-bottom: 20px;
    }

    input, button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #e5c1cd;
      margin: 5px;
      font-size: 14px;
    }

    button {
      background-color: #ffc8dd;
      cursor: pointer;
      border: none;
    }

    button:hover {
      background-color: #ffafcc;
    }

    .month-title {
      margin-top: 40px;
      font-weight: bold;
      color: #6d6875;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      max-width: 700px;
      margin: 10px auto 30px auto;
    }

    .day {
      padding: 14px;
      border-radius: 10px;
      font-size: 14px;
      background: #f8edeb;
      position: relative;
    }

    .header {
      font-weight: bold;
      background: #fae1dd;
    }

    .weekend {
      cursor: pointer;
      transition: 0.2s ease;
    }

    .weekend:hover {
      transform: scale(1.05);
    }

    .selected {
      outline: 3px solid #cdb4db;
    }

    /* ðŸŒ¸ Tooltip */
    .tooltip {
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: #ffffff;
      border: 1px solid #ffc8dd;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 12px;
      box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
      white-space: nowrap;
      display: none;
      z-index: 10;
    }

    .day:hover .tooltip {
      display: block;
    }

    .legend {
      margin-top: 20px;
      color: #6d6875;
      font-size: 14px;
    }
  </style>
</head>

<body>

  <h1>Summer 2026 Weekend Cabin Trip</h1>

  <input id="name" placeholder="Your name">
  <button onclick="submitAvailability()">Save Availability</button>

  <div id="calendars"></div>

  <div class="legend">
    Hover over a weekend to see who's free 
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
      getFirestore, 
      doc, 
      setDoc, 
      onSnapshot, 
      collection 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC1GbW69l72zHIxtATUvy6lISVPmz6Pd8I",
      authDomain: "weekendwhen2meet.firebaseapp.com",
      projectId: "weekendwhen2meet",
      storageBucket: "weekendwhen2meet.firebasestorage.app",
      messagingSenderId: "556817038663",
      appId: "1:556817038663:web:6af74f41e5888230efa062"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const container = document.getElementById("calendars");
    const selectedDates = new Set();
    let availabilityCounts = {};
    let availabilityNames = {};
    let totalUsers = 0;

    const daysOfWeek = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

    function createMonth(month, year, monthName, limitFirstWeekend = false) {
      const title = document.createElement("div");
      title.className = "month-title";
      title.innerText = monthName;
      container.appendChild(title);

      const calendar = document.createElement("div");
      calendar.className = "calendar";
      container.appendChild(calendar);

      daysOfWeek.forEach(day => {
        const div = document.createElement("div");
        div.className = "day header";
        div.innerText = day;
        calendar.appendChild(div);
      });

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);

      for (let i = 0; i < firstDay.getDay(); i++) {
        calendar.appendChild(document.createElement("div"));
      }

      for (let d = 1; d <= lastDay.getDate(); d++) {
        const date = new Date(year, month, d);
        const dateKey = date.toISOString().split("T")[0];
        const isWeekend = date.getDay() === 0 || date.getDay() === 6;
      
        const dayDiv = document.createElement("div");
        dayDiv.className = "day";
        dayDiv.innerText = d;
        dayDiv.dataset.date = dateKey;
      
        // Only allow first weekend in September
        if (limitFirstWeekend && month === 8 && d > 7) {
          calendar.appendChild(dayDiv);
          continue;
        }
      
        if (isWeekend) {
          dayDiv.classList.add("weekend");
      
          const tooltip = document.createElement("div");
          tooltip.className = "tooltip";
          tooltip.innerText = "No one yet ðŸ’­";
          dayDiv.appendChild(tooltip);
      
          dayDiv.onclick = () => {
            if (selectedDates.has(dateKey)) {
              selectedDates.delete(dateKey);
              dayDiv.classList.remove("selected");
            } else {
              selectedDates.add(dateKey);
              dayDiv.classList.add("selected");
            }
          };
        } else {
          // Soft pastel weekday look
          dayDiv.style.background = "#fdf2f5";
          dayDiv.style.opacity = "0.6";
        }
      
        calendar.appendChild(dayDiv);
      }
    }

    createMonth(4, 2026, "May 2026");
    createMonth(5, 2026, "June 2026");
    createMonth(6, 2026, "July 2026");
    createMonth(7, 2026, "August 2026");
    createMonth(8, 2026, "September 2026 (First Weekend Only)", true);

    window.submitAvailability = async function() {
      const name = document.getElementById("name").value.trim();
      if (!name) return alert("Enter your name!");

      const availability = {};
      selectedDates.forEach(date => {
        availability[date] = true;
      });

      await setDoc(doc(db, "responses", name), availability);
      alert("Saved ðŸ’•");
    };

    onSnapshot(collection(db, "responses"), snapshot => {
      availabilityCounts = {};
      availabilityNames = {};
      totalUsers = snapshot.size;

      snapshot.forEach(doc => {
        const name = doc.id;
        const data = doc.data();

        for (let date in data) {
          availabilityCounts[date] =
            (availabilityCounts[date] || 0) + 1;

          if (!availabilityNames[date]) {
            availabilityNames[date] = [];
          }
          availabilityNames[date].push(name);
        }
      });

      document.querySelectorAll(".weekend").forEach(day => {
        const dateKey = day.dataset.date;
        const count = availabilityCounts[dateKey] || 0;
        const tooltip = day.querySelector(".tooltip");

        if (totalUsers > 0) {
          const intensity = count / totalUsers;
          const pink = Math.floor(255 - intensity * 120);
          day.style.backgroundColor =
            `rgb(255, ${pink}, ${pink})`;
        }

        if (availabilityNames[dateKey]) {
          tooltip.innerText =
            availabilityNames[dateKey].join(", ");
        } else {
          tooltip.innerText = "No one yet ðŸ’­";
        }
      });
    });

  </script>

</body>
</html>
