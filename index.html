<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getFirestore, 
    doc, 
    setDoc, 
    onSnapshot, 
    collection 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyC1GbW69l72zHIxtATUvy6lISVPmz6Pd8I",
    authDomain: "weekendwhen2meet.firebaseapp.com",
    projectId: "weekendwhen2meet",
    storageBucket: "weekendwhen2meet.firebasestorage.app",
    messagingSenderId: "556817038663",
    appId: "1:556817038663:web:6af74f41e5888230efa062"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const weekends = [
    "May 1-3",
    "May 8-10",
    "May 15-17",
    "May 22-24",
    "May 29-31",
    "June 5-7",
    "June 12-14",
    "June 19-21",
    "June 26-28",
    "July 3-5",
    "July 10-12",
    "July 17-19",
    "July 24-26",
    "July 31 - August 2",
    "August 7-9",
    "August 14-16",
    "August 21-23",
    "August 28-30",
    "Septemeber 4-6"
  ];

  window.submitAvailability = async function() {
    const name = document.getElementById("name").value;
    if (!name) return alert("Enter your name!");

    let availability = {};
    weekends.forEach(date => {
      availability[date] = document.getElementById(date).checked;
    });

    await setDoc(doc(db, "responses", name), availability);
    alert("Saved!");
  };

  window.onload = function() {
    const container = document.getElementById("weekends");

    weekends.forEach(date => {
      container.innerHTML += `
        <div>
          <input type="checkbox" id="${date}">
          <label for="${date}">${date}</label>
        </div>
      `;
    });

    // Live updates
    onSnapshot(collection(db, "responses"), snapshot => {
      let counts = {};
      let totalUsers = snapshot.size;

      snapshot.forEach(doc => {
        let data = doc.data();
        for (let date in data) {
          if (data[date]) {
            counts[date] = (counts[date] || 0) + 1;
          }
        }
      });

      weekends.forEach(date => {
        const label = document.querySelector(`label[for='${date}']`);
        if (counts[date] === totalUsers && totalUsers > 0) {
          label.style.color = "green";
          label.style.fontWeight = "bold";
        } else {
          label.style.color = "black";
          label.style.fontWeight = "normal";
        }
      });
    });
  };
</script>
